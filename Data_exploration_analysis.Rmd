---
title: "Data_exploration_analysis"
output: html_document
date: '2022-07-24'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

Data Cleaning

binary_high_earnings variable:

To create the binary_high_earnings variable I first used 'md_earn_wne_p10-REPORTED-EARNINGS' to find the median earnings for each school reported that predominantly grants bachelor’s degrees. From these values, I created a categorical variable that groups the earnings by quartiles from 1-4. There was four quarters to represent first 25%, second 25%, third 25% and the last 25% in the set of data.    
0%    25%    50%    75%   100% 
16700  36600  42000  49400 166200 

I decided to use the 4th quartile with the range $49400-$166200 to represent the high earning schools, while the rest were low earning schools. This variable is in a binary format to compare high-earning schools (1) vs low-earning school (0).

Mean_index_by_date  variable:

First, I standardized each index for each keyword score by subtracting the mean and deviding by the standard deviation. To get to a index level of an average index score by date (month/year) and potential earnings (high(1)/low(0)), I  grouped the the standardized index by date and binary_high_earning. 

Before_score_card:

I created a binary variable before and after the introduction of the score card. Before the score card was introduced (1) on September 2015, and after the score card was introduced (0).


Analysis:

Research Question: Among colleges that predominantly grant bachelor’s degrees, did the release of the Scorecard shift student interest to high-earnings colleges relative to low-earnings ones.

The format of the variables that I created took into consideration the research question at hand. In the question it is looking at the comparison between high and low earnings schools. Therefore, I don't care as much about the individual schools or key words because I am more interested in grouping those schools into their earning potential and seeing their trends over time. This reasoning is why I chose to group the standardized indexes by the date and earning potential to be able to easily visualize how the indexes change before and after the score card was introduced for the high and low earning schools.


```{r pressure, echo=FALSE}
# Load Data
processed_data <- read_csv('Processed_data/processed_data.csv')
processed_data$binary_high_earnings <- as.factor(processed_data$binary_high_earnings)
processed_data$before_score_card <- as.factor(processed_data$before_score_card)
processed_data$Month <- as.factor(processed_data$Month)
```

Graph of the average index score by date for high (1) and low(0) earning schools. 

As you can see from the graph, there is a cyclical trend where there is an increase in popularity of key words fore both high earning and low earning schools in the spring, followed by a steep decrease in the summer and a in increase in the fall/ winter months. This trend throughout the school year is consistent with when students are applying for their undergraduate degrees. Interesting, the trend overall for both high and low earnings schools shows a steady decrease in popularity of key words (represented by standardized mean index by date) from the years 2013-2016. There is no indication of a change in the trend before or after the introduction of the score care in September 2015. The trends for both high and low earning schools shows the same trend of decreases in interest in the middle of the year, and near the end of the year before and after the score care was created.
```{r cars} 
processed_data %>% 
ggplot( aes(x = date, y = mean_index_by_date, color = binary_high_earnings)) +
  geom_line() + geom_point() + geom_vline(xintercept = as.Date("2015-09-01"))

```


```{r processed_data}

library(tidyverse) 

high_df <- processed_data %>% 
  select(date, mean_index_by_date, binary_high_earnings,before_score_card, Month ) %>% 
  filter(binary_high_earnings == 1)

low_df <- processed_data %>% 
  select(date, mean_index_by_date, binary_high_earnings,before_score_card, Month ) %>% 
  filter(binary_high_earnings == 0)


ggplot(high_df, aes(x = date, y = mean_index_by_date)) + 
  geom_point() + # Draw points
  geom_smooth(method = 'lm') # add OLS line


ggplot(low_df, aes(x = date, y = mean_index_by_date)) + 
  geom_point() + # Draw points
  geom_smooth(method = 'lm') # add OLS line
  


```





To answer the research question on if the release of the Scorecard shifted student interest to high-earnings colleges relative to low-earnings ones, I would want to know what effected the relative interest of those schools. In this case, the dependent variable would be the mean_index_by_date as this represents the interest or popularity of those schools. This is because the index is a score for how popular a given search term is for the prospective school in a given time. In this case its the popularity of those terms by month and year.

The independent variables for this case would be the factors that influence the popularity of the search terms and therefore the relative interest in the schools represented by high (1) vs low (0) earning. Based on the reserach question, we are interested in how the interest is shifted before and after the score card is introduced depending on the earning potential of the school. This suggests that there is a relationship between the whether the school is high or low earning and if the score card was introduced. The relationship between the interest (mean_index_by_date) and the high vs low earnings is different between whether it was before or after the score card was introduced. This means there is an interaction term.

Y: mean_index_by_date (continuous)
X: before_score_card(1/0)
Z: binary_high_earnings(1/0)
Control: Month (Categorical)

The relationship between X and  Y is different for different values of Z. To run the regression, we simply include X*Z  in the model, as well as Z by itself. The goal is to see how the Scorecard shifted interest between high- and low-earnings colleges.

However, looking at the initial graphs, there is a fluctuation throughout the years depending on the month. To control for the effect of month on the index score, it will need to be controlled in the model.


```{r processed_data}

# High and low earning schools controlling for month.
reg1 <-feols(mean_index_by_date ~ before_score_card + binary_high_earnings + before_score_card*binary_high_earnings + Month, data = processed_data)


# Low earning schools controlling for month
reg2 <-feols(mean_index_by_date ~ before_score_card + Month, data = low_df)


# High earning schools controlling for month
reg3 <-feols(mean_index_by_date ~ before_score_card  + Month, data = high_df)

etable(reg1, reg2, reg3)




```

heteroskedasticity Test:

Does the variance of the residuals differ across different levels of the x-axis. x-axis is before/after the score card was introduce. Going from before the score card was introduced to after  how does that change our probability of it being from a high earning school. We can calculate the variance of those residues for high earnings and low earnings separately

we are getting the residuals out of the model.The variance of the residuals for before the score card was introduced is 0.163 and after is 0.08. There is more unexplained variation from before the score card was introduced for index scores than for after. This is different accross the x-axis and therefore have heteroskedasticity. The model should use eteroskedasticity-robust standard errors in the model.


```{r processed_data}
processed_data%>% 
  mutate(resid = resid(reg1)) %>%
  group_by(before_score_card) %>%
  summarize(variance_of_resid = var(resid))

```



Original model with the with robust standard errors included. 

```{r processed_data}

reg1 <-feols(mean_index_by_date ~ before_score_card + binary_high_earnings + before_score_card*binary_high_earnings + Month, data = processed_data, vcov = 'hetero')
etable(reg1)

```

Broad interpretation of the results:

Linear regression model with interaction: Y = β0 + β1 X1 + β2 X2 + β3 X1X2

Model output: average_index_score =  0.2543 - 0.2862 before_score_card + 0.0502 binary_high_earnings - -0.2173 before_score_card × binary_high_earnings

mean_index_by_date: Continuous
  - Average index score by date and school earnings
before_score_card: Binary
  1: Before the score card was introduced (September 2015)
  0: After the score card was introduced (after September 2015)
binary_high_earnings: Binary
  1: High earning schools
  2: Low earning schools

B0 is the predicted index score when the variables before_score_card and binary_high_earnings are zero. This means the average index score for before the score card was introduced and was a low income school is 0.2543. B0 is statistically significant at the 0.01 level.

B1 is the difference in the average index score between groups where before_score_card = 0 and before_score_card = 1 and High earning schools = 0. Therefore, B1 is the difference in the average index scores from before and after the score cards were introduced for low earning schools. For low earning schools, after the score cards where introduced, are expected to have a decrease by 0.2862  index score compared to before the score card was introduced. B1 is statistically significant at the 0.001 level. 

B2 compares binary_high_earnings = 1 compared to binary_high_earning = 0 where before_score_card = 0.
Therefore, B2 is the difference in the average index score between high earning schools and low earning schools before the score card was introduced. Before the score card was introduced, high earning schools are expected to have an increase in index scores of 0.0502 compared to low earning schools. However, B2 is not statistically significant, therefore there is no significant difference between high earning and low earning before the score card was introduced.


b1 + b3
(- 0.2862) + (-0.2173) = 0.0689

0.0689 is the effect of the score card on index scores for High earning schools = 1. For high earning schools, after the score cards where introduced, are expected to have a increase by 0.0689 index score compared to before the score card was introduced.

In summary, the effect of the score card on average index scores is -0.2862 for low earning schools, and the effect of the score card on average index scores is 0.0689 for high earning schools. The difference between those two effects for high earning and low earning schools is -0.2173 (B3). The effect of the score card is lower for average index score is lower for high earning schools than for low earning schools.Therefore, the impact of the Scorecard negatively effected lower income schools and positively effected higher income schools. There was more of an effect on the lower income schools than for higher income.







